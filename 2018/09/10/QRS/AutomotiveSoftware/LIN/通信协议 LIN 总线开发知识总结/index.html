<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>LIN 总线开发知识总结 | yphfree的学习笔记</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">LIN 总线开发知识总结</h1><a id="logo" href="/.">yphfree的学习笔记</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">LIN 总线开发知识总结</h1><div class="post-meta">Sep 10, 2018<span> | </span><span class="category"><a href="/categories/汽车电子学习笔记/">汽车电子学习笔记</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#LIN总线介绍"><span class="toc-number">1.</span> <span class="toc-text">LIN总线介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LIN线与CAN最大的区别"><span class="toc-number">2.</span> <span class="toc-text">LIN线与CAN最大的区别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#拓扑结构"><span class="toc-number">3.</span> <span class="toc-text">拓扑结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LIN的特点"><span class="toc-number">4.</span> <span class="toc-text">LIN的特点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LIN总线数据帧格式"><span class="toc-number"></span> <span class="toc-text">LIN总线数据帧格式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#LIN总线传输调度"><span class="toc-number">1.</span> <span class="toc-text">LIN总线传输调度</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LIN总线诊断"><span class="toc-number">2.</span> <span class="toc-text">LIN总线诊断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LIN总线开发内容"><span class="toc-number">3.</span> <span class="toc-text">LIN总线开发内容</span></a></li></ol></div></div><div class="post-content"><h4 id="LIN总线介绍"><a href="#LIN总线介绍" class="headerlink" title="LIN总线介绍"></a>LIN总线介绍</h4><p>LIN（Local Interconnect Network）总线是基于UART/SCI（通用异步收发器/串行接口）的低成本串行通讯协议。其目标定位于车身网络模块节点间的低端通信，主要用于智能传感器和执行器的串行通信，而这正是CAN总线的带宽和功能所不要求的部分。</p>
<p>做为一个对CAN总线作为低成本辅助总线，LIN总线在车身控制中应用广泛，车门、车窗、车灯以及中控锁等都使用LIN线。</p>
<h4 id="LIN线与CAN最大的区别"><a href="#LIN线与CAN最大的区别" class="headerlink" title="LIN线与CAN最大的区别"></a>LIN线与CAN最大的区别</h4><p><strong>一，单线通信，传输速率较低</strong></p>
<p>LIN线在物理上是一个上拉到12V的集电极开漏总线，多个节点可以并联到同一根线上，与IIC的SDA类似，但其没有独立的时钟线，靠通信双方约定的波特率进行通信，与UART类似，但由于UART之处在于，其可以通过同步场进行时钟同步，使传输变得更可靠。这样与CAN总线的一对差分双绞线不同，其抗干扰能力大大减弱，通信速率最高只能20Kbps,而CAN可达1Mbps。</p>
<p><strong>二，主从结构，中心化拓扑。</strong></p>
<p>LIN线拓扑结构是主从结构的星型模型，所有传输都是master发起，slave不可以主动发起请求。这个其实与modbus更类似。也可以把slave看做消息的发布者，master看成消息的订阅者，想要获取某个变量值，就需要不断轮询读应节点对应的报文。这个结构就决定了LIN线传输的消息不可能太多，以保证消息更新的实时性，通常一条LIN线上定义的消息要比一条CAN线上定义的消息少一个数量级。当然，如果中心节点出现了问题，整个网络也就挂掉了。</p>
<p><strong>三，更轻量级的处理协议栈。</strong> </p>
<p>在汽车电子开发中，CAN总线协议栈占有相当大的代码量，包括CAN 驱动层、TP、NM、UDS、router、bootloader等等，但LIN开发量也会少一个数量级，包括驱动、调度表，简单的睡眠唤醒，简单的TP等，其上层的服务还是要转成CAN的信号进行传输。</p>
<h4 id="拓扑结构"><a href="#拓扑结构" class="headerlink" title="拓扑结构"></a>拓扑结构</h4><p>LIN 的拓扑结构为单线总线，应用了单一主机多从机的概念。总线电平为<br>12V，传输位速率(Bitrate)最高为20kbps。由于物理层限制，一个LIN网络最多可以连接16个节点，典型应用一般都在12个节点以下，主机节点有且只有一个，从机节点有1到15个。主机节点(Master Node)包含主机任务(Master Task)和从机任务(Slave Task)，从机节点(Slave Node)只包含从机任务，如下图所示：</p>
<p>主机任务负责：<br>(1) 调度总线上帧的传输次序；<br>(2) 监测数据，处理错误；<br>(3) 作为标准时钟参考；<br>(4) 接收从机节点发出的总线唤醒命令。</p>
<p>从机任务不能够主动发送数据，需要接收主机发送的帧头(帧的起始部分，参照3.1节的图3.1)，根据帧头所包含的信息(这里指帧ID，详细内容参照3.1.3节)判断：</p>
<p>(1) 发送应答(帧中除帧头外剩下的部分，参照3.1节的图3.1)；<br>(2) 接收应答；<br>(3) 既不接收也不发送应答。</p>
<h4 id="LIN的特点"><a href="#LIN的特点" class="headerlink" title="LIN的特点"></a>LIN的特点</h4><p>（1）网络由一个主节点与若干个从节点构成。</p>
<p>（2）使用LIN总线可以大幅度削减成本。</p>
<p>（3）传输具有确定性，传播时间可以提前计算</p>
<p>（4）LIN具有可预测的EMC（电磁兼容性）性能，为了限制EMC的强度，LIN协议规定最大传输速率为20kbps。</p>
<p>（5）LIN总线提供信号的配置、处理、识别和诊断功能。</p>
<h3 id="LIN总线数据帧格式"><a href="#LIN总线数据帧格式" class="headerlink" title="LIN总线数据帧格式"></a>LIN总线数据帧格式</h3><p>一个典型的<strong>LIN数据帧主要包含header、header response以及response域。</strong>LIN一帧数据最大可以传8bytes，比较有意思的一点是，LIN2.x规定可以传输的LIN字节数可选是2,4,8并不是1-8内任意一个数字。一般而言，车内会选择一个统一字节数，最常用比如每帧都传8个字节。</p>
<p>Header场中包含break，synch以及受保护的id。其实break就是告诉总线传输开始，然后用synch同步始终，然后使用受保护id来寻址，如果有LIN slave节点可以提供这个id的服务，那在master发出protected id后，就他就会插入一个应答，与IIC从机在sda上给出类似应答类似。值得注意的是，这个protected id并不是slave从机地址，而是想要订阅的报文id，换个说法，一个slave从机可以提供多个报文id的服务，比如一个车灯控制ECU，可以提供灯控制、状态、故障码、软硬件版本信息等多个LIN ID服务。而slave从机地址是隐性的与其所提供的报文ID是有个对应关系的。</p>
<p>与CAN总线的CRC校验不同，LIN的提供奇偶校验以及checksum方式，对header中的protected id进行奇偶校验，也会对data进行checksum校验，有classic以及enhanced区分。</p>
<h4 id="LIN总线传输调度"><a href="#LIN总线传输调度" class="headerlink" title="LIN总线传输调度"></a>LIN总线传输调度</h4><p>LIN总线的主从结构决定了master节点要周期性的去slave读取数据，也可以去设置一个报文。一条LIN总线上有多个slave节点，每个slave要发布多个ID报文时，就需要master在兼顾实时行的条件下，顺序的读取或这设置每个slave的每个ID报文。对于每个slave可以提供哪些报文，有<strong>ldf文件</strong>统一描述，与CAN的dbc文件不同。Ldf文件全称为LIN Configuration Description File，描述了一条LIN bus完整的主从节点信息，以及报文格式，调度信息。根据ldf文件可以得到<strong>schedule tables</strong>，这个调度表给master设置了读取slave节点报文id的时间间隔，比如10ms，100ms。这个调度表可以由专门的生成工具由ldf文件来生成。</p>
<h4 id="LIN总线诊断"><a href="#LIN总线诊断" class="headerlink" title="LIN总线诊断"></a>LIN总线诊断</h4><p>在整个汽车网络中，目前最复杂的就是CAN诊断部分，LIN诊断可以说只是一个补充，LIN支持使用0x3C(master request frame)以及0x3D(slave response frame)两个报文进行对LIN slave的诊断，其帧格式（报文内8 bytes的数据）如下所示：<br><a href="https://blog.csdn.net/DanielLee_ustb/article/details/79143161" target="_blank" rel="noopener">https://blog.csdn.net/DanielLee_ustb/article/details/79143161</a></p>
<p>其中NAD为address of the slave node，表明是要诊断哪一个ECU; PCI为Protocol Control Information，表明该报文代表是一个什么样的诊断保文; SID 为Service Identifier,表明该报文对应的服务是什么;其他为数据长度以及数据分片。</p>
<p>LIN总线的诊断与CAN诊断各个服务保持一致，但不需要支持那么多服务，一般而言只需要支持比如通信控制、读取DID、读取DTC等服务即可，少数可以进行固件升级的LIN ECU还需要支持安全访问、程序下载、复位等服务。</p>
<h4 id="LIN总线开发内容"><a href="#LIN总线开发内容" class="headerlink" title="LIN总线开发内容"></a>LIN总线开发内容</h4><p>(1)EE拓扑规划以及ldf文件的定义;<br>(2)根据ldf文件由专门的工具生成schedule tables，以及信号层;<br>(3)开发或集成LIN driver、LIN TP;<br>(4)开发相关LIN发送以及接收task，轮询各节点报文;<br>(5)接收上层控制信号对slave进行设置，接受slave信号的变化反馈给上层应用;<br>(6)对于诊断部分的处理;<br>(7)错误处理;<br>(8)LIN睡眠和唤醒的控制。</p>
</div><div class="tags"><a href="/tags/汽车电子/">汽车电子</a></div><div class="post-nav"><a class="pre" href="/2018/09/11/QRS/AutomotiveSoftware/LIN/通信协议 LIN开发流程(for freescale)/">LIN开发流程(for freescale)</a><a class="next" href="/2018/09/10/QRS/AutomotiveSoftware/CAN/通信协议 CAN总线基础知识/">CAN协议简介</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android学习笔记/">Android学习笔记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CC2540/">CC2540</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/C语言学习/">C语言学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/FreeRTOS/">FreeRTOS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Numpy学习笔记/">Numpy学习笔记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PyQt5快速开发与实战/">PyQt5快速开发与实战</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python学习笔记/">Python学习笔记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/S3C2440学习笔记/">S3C2440学习笔记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/STM32学习笔记/">STM32学习笔记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/单片机/">单片机</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/嵌入式开发学习笔记/">嵌入式开发学习笔记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构与算法之美学习笔记/">数据结构与算法之美学习笔记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/汽车总线/">汽车总线</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/汽车电子学习笔记/">汽车电子学习笔记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/硬件学习笔记/">硬件学习笔记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/统一诊断服务UDS/">统一诊断服务UDS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/软件开发/">软件开发</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/通信协议/" style="font-size: 15px;">通信协议</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/硬件基础/" style="font-size: 15px;">硬件基础</a> <a href="/tags/锂电池/" style="font-size: 15px;">锂电池</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/Python3/" style="font-size: 15px;">Python3</a> <a href="/tags/PyQt5/" style="font-size: 15px;">PyQt5</a> <a href="/tags/Python-Numpy/" style="font-size: 15px;">Python Numpy</a> <a href="/tags/嵌入式基础知识-硬件基础知识/" style="font-size: 15px;">嵌入式基础知识 硬件基础知识</a> <a href="/tags/STM32基础/" style="font-size: 15px;">STM32基础</a> <a href="/tags/嵌入式基础知识/" style="font-size: 15px;">嵌入式基础知识</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/嵌入式基础知识-通信协议/" style="font-size: 15px;">嵌入式基础知识 通信协议</a> <a href="/tags/嵌入式基础知识-通信协议/" style="font-size: 15px;">嵌入式基础知识, 通信协议</a> <a href="/tags/C51/" style="font-size: 15px;">C51</a> <a href="/tags/S3C2440/" style="font-size: 15px;">S3C2440</a> <a href="/tags/STM32项目/" style="font-size: 15px;">STM32项目</a> <a href="/tags/CC2540/" style="font-size: 15px;">CC2540</a> <a href="/tags/FreeRTOS/" style="font-size: 15px;">FreeRTOS</a> <a href="/tags/有限状态机/" style="font-size: 15px;">有限状态机</a> <a href="/tags/汽车电子/" style="font-size: 15px;">汽车电子</a> <a href="/tags/LIN/" style="font-size: 15px;">LIN</a> <a href="/tags/统一诊断服务UDS/" style="font-size: 15px;">统一诊断服务UDS</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/05/01/QRS/S3C2440/解析S3C2440第一个C程序的内部机制/">解析S3C2440第一个C程序的内部机制</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/23/SoftWare_skills/Finite_State_Machine/状态机/">有限状态机,</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/23/SoftWare_skills/Finite_State_Machine/用状态机原理进行软件设计——FSM概念/">用状态机原理进行软件设计——FSM概念</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/14/QRS/AutomotiveSoftware/Diagnostic/统一诊断服务/">汽车控制器(ECU)统一诊断服务基础知识</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/04/QRS/AutomotiveSoftware/LIN/LIN总线诊断的实现/">LIN学习——LIN总线诊断的实现</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/04/QRS/AutomotiveSoftware/Diagnostic/汽车ECU诊断基本概念/">汽车ECU诊断基本概念</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/03/QRS/AutomotiveSoftware/Diagnostic/CAN诊断基础知识/">CAN诊断基础知识</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/20/QRS/AutomotiveSoftware/LIN/LIN学习——LIN应用层/">QRS/AutomotiveSoftware/LIN/LIN学习——LIN应用层</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/20/QRS/AutomotiveSoftware/LIN/LIN学习——工作流/">LIN学习——工作流</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/19/QRS/AutomotiveSoftware/LIN/LIN学习——LIN描述文件/">QRS/AutomotiveSoftware/LIN/LIN学习——LIN描述文件</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">yphfree的学习笔记.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>